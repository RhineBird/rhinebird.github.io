(()=>{function O(r){let c="seline_vid",p="seline-do-not-track",v=r.apiHost??"https://api.seline.com",h=`${v}${r.apiHost?"/ennui/blase":"/s/e"}`,b=`${v}${r.apiHost?"/ennui/su":"/s/su"}`,w=r.token,m=r.maskPatterns??[],S=r.skipPatterns??[],k=r.cookieOnIdentify??!1,u=r.cookie??!1,y=r.outbound??!1,s=_(c),g={},E=null,d=sessionStorage.getItem("seline:referrer")?"":document.referrer;function _(t){let e=document.cookie.match(new RegExp(`(^|;\\s*)${t}=([^;]*)`));return e?decodeURIComponent(e[2]):null}function P(t,e,i=365){let n=new Date;n.setTime(n.getTime()+i*24*60*60*1e3);let o=location.hostname.split(".").slice(-2).join(".");document.cookie=`${t}=${encodeURIComponent(e)};expires=${n.toUTCString()};path=/;domain=.${o};SameSite=Lax`}function $(){return localStorage.getItem(p)==="1"}function R(){localStorage.setItem(p,"1")}function N(){let t=history.pushState;history.pushState=function(...i){t.apply(this,i),f()},addEventListener("popstate",()=>f());function e(){!E&&document.visibilityState==="visible"&&f()}document.visibilityState!=="visible"?document.addEventListener("visibilitychange",e):f(),x()}function L(t=!1){r.autoPageView&&!t||(r.autoPageView=!0,N())}function I(t){let e=S.map(n=>new RegExp(`^${n.replace(/\*/g,"[^/]+")}$`)),i=m.map(n=>new RegExp(`^${n.replace(/\*/g,"[^/]+")}$`));if(e.some(n=>n.test(t)))return null;for(let n=0;n<m.length;n++)if(i[n].test(t))return m[n];return t}function T(t,e,i=!0){if($()||(window.Cypress||window.__phantom||window.__nightmare||window.navigator.webdriver)&&!window.__seline)return Promise.resolve();let n={...e};return g.userId&&(n.visitorId=g.userId),s&&(n.visitorId=s),i&&!(!s&&u)&&navigator?.sendBeacon?(navigator.sendBeacon(t,JSON.stringify(n)),Promise.resolve()):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),keepalive:!0}).then(async l=>{if(u&&!s&&l.ok){let a=await l.json();a?.visitorId&&(s=a.visitorId,P(c,s))}})}function C(t){T(h,{token:w,...t},!0)}function A(t,e){let i=I(window.location.pathname);i&&C({pathname:i+window.location.search,name:t,data:e})}function f(t){let e=t??window.location.pathname;if(E===e)return;E=e;let i=I(e);i&&((!d||d.includes(window.location.hostname))&&(d=null),C({pathname:t?i:i+window.location.search,referrer:d}),d&&(d=null,sessionStorage.setItem("seline:referrer","set")))}function U(t){g={...g,...t},T(b,{token:w,fields:g},!1).then(async e=>{if(e){let i=await e.json();i?.visitorId&&(s=i.visitorId,(k||u)&&P(c,s))}})}function x(){document.addEventListener("click",t=>{let e=t.target;if(!e||(e.tagName==="INPUT"||e.tagName==="SELECT"||e.tagName==="TEXTAREA")&&e.type!=="submit")return;if(y){let o=e;for(;o&&o.tagName!=="A";)o=o.parentElement;if(o&&o.tagName==="A"){let l=o,a=l.href;a&&l.hostname&&l.hostname!==window.location.hostname&&A("outbound link: clicked",{url:a,text:l.textContent?.trim()||"",hostname:l.hostname})}}for(;e&&!e?.hasAttribute("data-sln-event");)e=e.parentElement;if(!e)return;let i=e.getAttribute("data-sln-event");if(!i)return;let n={};for(let o of Array.from(e.attributes))o.name.startsWith("data-sln-event-")&&o.value&&(n[o.name.slice(15)]=o.value);if(e.tagName==="FORM"){let o=e,l=Array.from(o.elements);for(let a of l)a.type!=="password"&&a.name&&a.value&&(n[a.name]=a.value)}A(i,n)})}function H(){u=!0,s&&P(c,s)}return{track:A,page:f,setUser:U,enableAutoPageView:L,doNotTrack:R,enableCookieMode:H}}if(!window.seline){let c=function(u){return u?u.replace(/^\[|\]$/g,"").split(",").map(y=>y.trim().replace(/^['"]|['"]$/g,"")).filter(Boolean):[]},r=document.currentScript?.getAttribute("data-token"),p=c(document.currentScript?.getAttribute("data-skip-patterns")),v=c(document.currentScript?.getAttribute("data-mask-patterns")),h=document.currentScript?.getAttribute("data-auto-page-view")!=="false",b=document.currentScript?.getAttribute("data-api-host"),w=document.currentScript?.getAttribute("data-cookie-on-identify")==="true",m=document.currentScript?.getAttribute("data-cookie")==="true",S=document.currentScript?.getAttribute("data-outbound")==="true",k=O({token:r,skipPatterns:p,maskPatterns:v,autoPageView:h,apiHost:b,cookieOnIdentify:w,cookie:m,outbound:S});window.seline=k,h&&k.enableAutoPageView(!0)}})();
